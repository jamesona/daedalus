<html>
<head>
	<title>Daedalus</title>
	<link rel="stylesheet" href="./style.css"  />
	<script src='./state.js'></script>
</head>
<body onload="loadState()">
	<header>
		<img src="./champion.gif" />
		<div>
			<h1>Daedalus: Rogue-Like</h1>
		</div>
	</header>
	<aside>
		<form class="login">
			<input type="text" placeholder="Username" name="userName"></input>
			<input type="password" placeholder="Password" name="password"></input>
			<input type="submit" />
		</form>
		<span class="alert"></span>
	</aside>
	<main>
		<div class="definition">
			<p>
				<a href="https://en.wikipedia.org/wiki/Daedalus" target="_blank">Daedalus</a>:
				builder of the mythical Labyrinth.
			</p>
		</div>
		<div class="definition">
			<p>
				<a href="https://en.wikipedia.org/wiki/Roguelike" target="_blank">Roguelike</a>:
				A game belonging to a sub-genre of video games, characterized by a dungeon crawl
				through procedurally generated game levels, turn-based gameplay, tile-based graphics,
				and permanent death of the player-character.
			</p>
		</div>
		<h3>Description</h3><hr/>
		<p>
			In the context of this project, Daedalus is the title of a minimal roguelike rpg
			that takes place in an infinite labyrinth. It is a project for my college web-design
			class, and while it is far from my first web app, it is my first attempt at a video game.
		</p>
		<p>
			Daedalus is played using only the mouse, to direct your character around a 5x5 grid of tiles.
			This 5x5 grid represents one room of infinitely many, and each tile represents a floor, wall,
			or door. Additionally, any floor tiles also hold data about what, if anything, is occupying
			that space: you, a monster, an item, etc. Each room contains 2-4 doors, that lead to other rooms.
			<a href="./game/index.html">Demo</a>
		</p>
		<h3>Software Design</h3>
		<h4>Model</h4>
		<ul>
			<li>
				Player: the player model
				<ul>
					<li>stats - current player stats</li>
					<li>inventory - current player inventory</li>
					<li>equipment - current player equipment</li>
					<li>location - current place in the room</li>
				</ul>
			</li>
			<li>
				Mobiles: a collection of currently generated monsters
				<ul>
					<li>stats - current moster stats</li>
					<li>drops - potential loot to drop</li>
				</ul>
			</li>
			<li>
				Map: all the data for the currently generated/explored map
				<ul>
					<li>
						rooms - two dimensional arrays of cell data
						<ul>
							<li>
								cells - actual data for a cell
								<ul>
									<li>type - floor, wall, etc.</li>
									<li>contents - loot, creature, player, etc.</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				Items: a container for all possible items and their data
			</li>
		</ul>
		<h4>View</h4>
		<ul>
			<li>
				header - the top portion of the page
				<ul>
					<li>minimap - a small map of your current location in the labyrinth</li>
					<li>main navigation - buttons to control the game</li>
				</ul>
			</li>
			<li>
				main - the middle portion of the page
				<ul>
					<li>left sidebar - inventory/item data</li>
					<li>viewport - the table containing the main view</li>
					<li>right sidebar - equipment/misc information (creature data, etc.)</li>
				</ul>
			</li>
			<li>
				footer - the bottom portion of the page
				<ul>
					<li>hot-bar - a place to hold buttons for activating skills and equipment</li>
				</ul>
			</li>
		</ul>
		<h3>Sample state</h3><hr/>
		<pre>
		</pre>
	</main>
</body>
<script>
	function loadState() {
		var state = JSON.parse(localStorage.getItem('gameState'))
		document.querySelector('pre').innerHTML = JSON.stringify(state, null, '  ')
	}
	function dismiss(ele) {
		ele.classList.remove('visible')
		setTimeout(()=>{
			ele.innerHTML = ''
			ele.classList.remove('success')
			ele.classList.remove('fail')
		}, 500)
	}
	function handleSubmit(evt) {
		evt.preventDefault()
		var form = evt.target
		var alert = form.parentElement.querySelector('.alert')
		var inputs = form.querySelectorAll('input:not([type="submit"])')
		var body = {}
		inputs.forEach(input => {
			body[input.name] = input.value
		})
		post({
			method: 'POST',
			body: body,
			url: 'http://universe.tc.uvu.edu/cs2550/assignments/PasswordCheck/check.php'
		}).then(res => {
			response = JSON.parse(res)
			if (response.result === 'valid') {
				localStorage.setItem('cs2550timestamp', response.userName + ' ' + response.timestamp)
				alert.innerHTML = 'Logged-in!'
				alert.classList.add('success')
				setTimeout(() => {
					location.assign('game/index.html')
				}, 500)
			} else {
				alert.innerHTML = 'Invalid username or password!'
				alert.classList.add('fail')
			}
			alert.classList.add('visible')
			alert.onclick = evt => dismiss(alert)
			setTimeout(()=>dismiss(alert), 5000)
		})
	}
	function post(config) {
		var XHR = new XMLHttpRequest()
		return new Promise((resolve, reject) => {
			XHR.onreadystatechange = function() {
				if (this.readyState === 4) {
					if (this.status == 200)
						resolve(XHR.responseText)
					else
						reject(XHR.responseText)
				}
			}
			Object.keys(config.body).forEach(key => {
				if (config.url.indexOf('?') < 0)
					config.url += '?'
				else
					config.url += '&'
				config.url += key + '=' + config.body[key]
			})
			XHR.open(config.method, config.url, true)
			XHR.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
			XHR.send()
		})
	}
	document.querySelector('form').onsubmit = handleSubmit
</script>
</html>
